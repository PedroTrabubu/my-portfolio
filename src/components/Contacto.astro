---
import LinkedInIcon from "../icons/LinkedIn.astro";
import Gmail from "../icons/Gmail.astro";
import LinkedInNormalColor from "../icons/LinkedInNormalColor.astro"

const FORM_ACTION = "https://formspree.io/f/xwpakdab";
---

<section
  id="contact"
  class="mx-auto flex max-w-4xl flex-col items-center justify-center py-20 px-6"
>
  <h2
    class="text-3xl md:text-4xl font-bold text-center text-gray-900 dark:text-white mb-12"
  >
    Contacto
  </h2>

  <div class="flex flex-col md:flex-row gap-12 w-full">
    <!-- Lado izquierdo -->
    <div class="w-full md:w-1/2 space-y-6 text-gray-700 dark:text-gray-300">
      <h3 class="text-xl font-semibold text-green-600 dark:text-green-300">
        ¡Dime hola!
      </h3>
      <p class="text-lg leading-relaxed">
        Gracias por llegar hasta aquí. Significa mucho para mí y me hace feliz
        tu interés. No todo son malas noticias:
        <span class="text-green-600 dark:text-green-300"> ¡podemos seguir hablando!</span>
      </p>
      <p class="text-lg leading-relaxed">
        Escríbeme usando el formulario, por email o contacta conmigo en
        LinkedIn. Estaré encantado de leerte.
      </p>

      <ul class="space-y-3 mt-6">
        <li>
          <a
            href="mailto:pedro.blanquer.cerro@gmail.com"
            class="inline-flex items-center gap-2 text-green-600 dark:text-green-300 hover:underline hover:scale-[1.02] transition-transform"
          >
            <Gmail class="w-5 h-5 text-green-600 dark:text-green-300" />
            <span>Email</span>
          </a>
        </li>
        <li>
          <a
            href="https://www.linkedin.com/in/pedro-blanquer-cerro-b3b71a350/"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 text-green-600 dark:text-green-300 hover:underline hover:scale-[1.02] transition-transform"
          >
            <LinkedInNormalColor class="w-5 h-5 fill-green-600 dark:fill-green-300" />
            <span>LinkedIn</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- Formulario -->
    <div class="w-full md:w-1/2">
      <form id="contactForm" action={FORM_ACTION} method="POST" class="space-y-6">
        <div class="flex flex-col md:flex-row gap-4">
          <div class="flex-1">
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-200">
              Nombre <span class="text-green-600 dark:text-green-300">*</span>
            </label>
            <input
              type="text"
              name="name"
              required
              placeholder="Juan Ramírez"
              class="mt-1 w-full rounded-md border border-gray-300 dark:border-gray-600 bg-transparent px-3 py-2 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:outline-none transition"
            />
          </div>

          <div class="flex-1">
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-200">
              Email <span class="text-green-600 dark:text-green-300">*</span>
            </label>
            <input
              type="email"
              name="email"
              required
              placeholder="ejemplo@email.com"
              class="mt-1 w-full rounded-md border border-gray-300 dark:border-gray-600 bg-transparent px-3 py-2 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:outline-none transition"
            />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-200">
            Mensaje <span class="text-green-600 dark:text-green-300">*</span>
          </label>
          <textarea
            name="message"
            rows="5"
            required
            placeholder="¡No dudes en escribirme!"
            class="mt-1 w-full rounded-md border border-gray-300 dark:border-gray-600 bg-transparent px-3 py-2 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:outline-none transition resize-none"
          ></textarea>
        </div>

        <p id="formMessage" class="mt-3 text-sm hidden"></p>

        <button
          id="submitBtn"
          type="submit"
          class="w-full md:w-auto rounded-full cursor-pointer bg-green-600 hover:bg-green-700 text-white font-semibold px-8 py-3 transition-all shadow-sm hover:shadow-md focus-visible:ring-2 focus-visible:ring-green-500 focus-visible:ring-offset-2"
        >
          Enviar mensaje
        </button>
      </form>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById("contactForm");
  const message = document.getElementById("formMessage");
  const button = document.getElementById("submitBtn");

  form.addEventListener("submit", async (e) => {
    e.preventDefault(); // Evita la navegación
    message.classList.add("hidden");
    button.disabled = true;
    button.textContent = "Enviando...";

    const formData = new FormData(form);

    try {
      const response = await fetch(form.action, {
        method: "POST",
        body: formData,
        headers: { Accept: "application/json" },
      });

      if (response.ok) {
        message.textContent = "✅ ¡Mensaje enviado con éxito!";
        message.className = "text-green-600 dark:text-green-300 text-sm font-medium mt-3";
        form.reset();
      } else {
        throw new Error("Error en el envío");
      }
    } catch (err) {
      message.textContent =
        "❌ Ocurrió un error al enviar el mensaje. Inténtalo de nuevo más tarde.";
      message.className = "text-red-500 text-sm font-medium mt-3";
    } finally {
      message.classList.remove("hidden");
      button.disabled = false;
      button.textContent = "Enviar mensaje";
    }
  });
</script>
